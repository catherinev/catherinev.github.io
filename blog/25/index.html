<!DOCTYPE html>
<html>
  <head>
    <title>Catherine V</title>
    <link data-turbolinks-track="true" href="/assets/application.css" media="all" rel="stylesheet" />
    <link href='http://fonts.googleapis.com/css?family=Gafata' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto:300italic,300,500' rel='stylesheet' type='text/css'>
  </head>

  <body>
    <h1>Catherine Vongsathorn</h1>
    <script src="/assets/application.js"></script>
<div class = "nav">
  <button id = "menu-icon">menu</button>
  <div><a href="/">Home</a></div>
  <div><a href="/about/">About</a></div>
  <div><a href="/blog/">Blog</a></div>
  <div><a href="/experience/">Experience</a></div>
  <div><a href="/links/">Links</a></div>
</div>

    
    <h2>Sunday, July 20, 2014</h2>
<div class = "post">
  <h3>Don't Park There Chicago: the database</h3>
  <h4>See <a href = "/blog/24/">this post</a> for more background on the Don't Park There Chicago</h4>

  <p>The data that backs <a href = "http://dontparkthere.herokuapp.com">Don't Park There Chicago</a> is available in the City of Chicago Data Portal, specifically at <a href ="https://data.cityofchicago.org/Sanitation/Map-Street-Sweeping-2014/czxu-ejis">this</a> site. The dataset includes all the information we needed to make the site -- geospatial encoding of each street sweeping region and the corresponding street sweeping dates for 2014.  Before our app could do anything useful, we had to figure out how to harness the data from the data portal. After doing some research, we decided to store the data into a PostgreSQL database supported by PostGIS, an extension that allows PostgreSQL to store geospatial data and provides query support for that data.  Although we hadn't used PostGIS before, the documentation was great, so we were able to figure out how to use it pretty quickly.</p>

  <p>However, getting the data from the data portal to our own database did not go smoothly.  The data portal provides several different options for the format of the data: Shapefile, KML, and KMZ.  Theoretically, it should have been easy to import the Shapefile directly into our database.  However, when we imported the Shapefile, none of the geospatial queries yielded the expected results.  Part of the issue was that the data in our database was encoded, so it was difficult to tell why the queries weren't behaving as expected.</p>

  <p>Eventually, we decided to start from scratch and import the data directly from the KML file.  This had the advantage of importing the data in a human-readable format, which made some problems easier to debug.  At first we only loaded 4 rows into the database and ran some queries on those.  Happily, the queries gave the expected results!  One of my teammates wrote a parser that allowed us to easily import the rest of the data to our database.  It was, perhaps, not the most elegant solution.  But it totally worked.</p>

  <p>The next step was to deploy our site with the database intact.  At this stage, the database wasn't even connected to the front end -- we just wanted to make sure that when we deployed, the database deployed correctly.  However, it didn't.  After we deployed to Heroku, we opened the database on Heroku and the table with geospatial data simply wasn't there.  Some research revealed that Heroku charges a minimum of $50 per month to host databases with PostGIS, so we needed to make a new plan.  Eventually we decided to use Amazon RDS to host the database and Heroku to host the site itself.  This is currently costing us $0.04 per month and was relatively painless to set up.</p>

  <p>The next challenge with the database was optimizing its performance.  We had a basic version of the site up and running on day 4, but each page took 5-10 seconds to load.  Some analysis revealed that the geospatial queries were expensive.  So we looked at the methods that were querying the database and rewrote them so that each method only queried the database once.  That modification significantly cut down the page load time.</p>

  <p>Troubleshooting the database was one of my favorite parts of the project.  While it was sometimes stressful to discover problems (especially when it was difficult to discern the root of the issue), fixing the problems was so much more rewarding than I expected.</p>


</div>


    <footer>
  <div id = "left">Contact me: <a href="mailto:cvong47@gmail.com">Email</a></div>
  <div id = "right">&copy;2015 Catherine Vongsathorn</div>
</footer>


  </body>
</html>
